(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(9405)}])},9405:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return K}});var r,a=n(5893),s=n(7294);!function(e){e.Video="video",e.Image="image"}(r||(r={}));var i=n(4051),o=n.n(i),c=n(2637),l=n(8155);function u(e,t,n,r,a,s,i){try{var o=e[s](i),c=o.value}catch(l){return void n(l)}o.done?t(c):Promise.resolve(c).then(r,a)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function i(e){u(s,r,a,i,o,"next",e)}function o(e){u(s,r,a,i,o,"throw",e)}i(void 0)}))}}var m=function(){var e=d(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("adding order ",t,"To DB"),e.next=3,fetch("../api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=d(o().mark((function e(t,n){var r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("../api/orders?buyer=".concat(t.toString()));case 2:if(200!==(r=e.sent).status){e.next=12;break}return e.next=6,r.json();case 6:if(a=e.sent,console.log("Current wallet's orders are:",a),!(a.length>0)){e.next=12;break}if(!a.find((function(e){return e.buyer===t.toString()&&e.itemID===n}))){e.next=12;break}return e.abrupt("return",!0);case 12:return e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),f=function(){var e=d(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("../api/fetchItem",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemID:t})});case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x=n(6938),h=function(e,t){return"https://gateway.ipfscdn.io/ipfs/".concat(e,"?filename=").concat(t)},g=function(e){var t=e.hash,n=e.filename,r=h(t,n);return(0,a.jsx)("div",{children:r?(0,a.jsx)("div",{className:"download-component",children:(0,a.jsx)("a",{className:"download-button",href:r,download:n,target:"_blank",children:"Download"})}):(0,a.jsx)("p",{children:"Downloading file..."})})},v=n(8764).Buffer;function y(e,t,n,r,a,s,i){try{var o=e[s](i),c=o.value}catch(l){return void n(l)}o.done?t(c):Promise.resolve(c).then(r,a)}function j(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function i(e){y(s,r,a,i,o,"next",e)}function o(e){y(s,r,a,i,o,"throw",e)}i(void 0)}))}}var b="Initial",w="Submitted",N="Paid",k=function(e){var t=e.itemID,n=(0,x.Rc)().connection,r=(0,x.Os)(),i=r.publicKey,u=r.sendTransaction,d=(0,s.useMemo)((function(){return l.RG.generate().publicKey}),[]),h=(0,s.useState)(null),y=h[0],k=h[1],S=(0,s.useState)(!1),P=S[0],O=S[1],C=(0,s.useState)(b),T=C[0],_=C[1],I=(0,s.useMemo)((function(){return{buyer:"".concat(i).toString(),orderID:d.toString(),itemID:t}}),[i,d,t]),E=function(){var e=j(o().mark((function e(){var t,r,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O(!0),e.next=3,fetch("../api/createTransaction",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)});case 3:return t=e.sent,e.next=6,t.json();case 6:return r=e.sent,a=l.YW.from(v.from(r.transaction,"base64")),console.log("Tx data is",a),e.prev=9,e.next=12,u(a,n);case 12:s=e.sent,console.log("Transaction sent: https://solscan.io/tx/".concat(s,"?cluster=devnet")),_(w),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(9),console.error(e.t0);case 20:return e.prev=20,O(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[9,17,20,23]])})));return function(){return e.apply(this,arguments)}}();return(0,s.useEffect)((function(){function e(){return(e=j(o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p("".concat(i),t);case 2:if(!e.sent){e.next=10;break}return _(N),e.next=7,f(t);case 7:n=e.sent,k(n),console.log("Address has already purchased this item!");case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}i&&t&&function(){e.apply(this,arguments)}()}),[i,t]),(0,s.useEffect)((function(){if(T===w){O(!0);var e=setInterval(j(o().mark((function t(){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,c.f1)(n,d);case 3:if(r=t.sent,console.log("Find reference result:",r),!r.err){t.next=8;break}return console.warn("Transaction failed:",r.err),t.abrupt("return",null);case 8:console.log("Finding tx reference",r.confirmationStatus),"confirmed"!==r.confirmationStatus&&"finalized"!==r.confirmationStatus||(clearInterval(e),_(N),m(I),O(!1),alert("Thank you for your purchase!")),t.next=17;break;case 12:if(t.prev=12,t.t0=t.catch(0),a=t.t0,!(null!=(s=c.Eb)&&"undefined"!==typeof Symbol&&s[Symbol.hasInstance]?s[Symbol.hasInstance](a):a instanceof s)){t.next=16;break}return t.abrupt("return",null);case 16:console.error("Unknown error",t.t0);case 17:return t.prev=17,O(!1),t.finish(17);case 20:case"end":return t.stop()}var a,s}),t,null,[[0,12,17,20]])}))),1e3);return function(){clearInterval(e)}}function r(){return(r=j(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(t);case 2:n=e.sent,k(n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}T===N&&function(e){r.apply(this,arguments)}(t)}),[T]),i?P?(0,a.jsx)("span",{children:"Buying..."}):(0,a.jsx)("div",{children:T===N?(0,a.jsxs)(a.Fragment,{children:[!!y&&(0,a.jsx)(g,{filename:y.filename,hash:y.hash}),!y&&(0,a.jsx)("button",{disabled:!0,className:"buy-button",children:"Loading..."})]}):(0,a.jsx)("button",{disabled:P,className:"buy-button",onClick:E,children:"Buy now \ud83e\udc1a"})}):(0,a.jsx)("div",{children:(0,a.jsx)("p",{children:"You need to connect your wallet to make transactions"})})},S=function(e){var t=e.uuid,n=e.name,s=e.price,i=e.description,o=e.image_url,c=e.type;return(0,a.jsxs)("div",{className:"block bg-[#22252b] border-[1px] border-red rounded-lg p-2",children:[(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)("strong",{className:"relative h-6 px-4 text-xs leading-6 uppercase bg-black",children:[" ","New"," "]})}),(0,a.jsxs)("a",{href:"/products/".concat(t),title:n,className:"min-h-[280px] max-h-[280px] h-[280px]",children:[c===r.Image&&(0,a.jsx)("img",{alt:n,src:o,className:"object-cover w-full -mt-3 min-h-[280px] max-h-[280px] h-[280px]]"}),c===r.Video&&(0,a.jsx)("video",{className:"clip w-full object-cover shadow-lg -mt-3 min-h-[280px] max-h-[280px] h-[280px]",autoPlay:!0,loop:!0,controls:!1,muted:!0,children:(0,a.jsx)("source",{src:o,type:"video/mp4"})})]}),(0,a.jsx)("a",{href:"/products/".concat(t),title:n,children:(0,a.jsx)("h5",{className:"mt-4 text-lg hover:underline",children:n})}),(0,a.jsx)("p",{className:"text-sm truncate",children:i}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4 font-bold",children:[(0,a.jsxs)("p",{className:"text-lg",children:["$ ",s," USDC"]}),(0,a.jsx)("div",{className:"text-xs tracking-wide uppercase",children:(0,a.jsx)("div",{className:"block px-2 py-1 text-sm font-medium text-white transition bg-indigo-600 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring",children:(0,a.jsx)(k,{itemID:t})})})]})]})};function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var O=function(e){var t=e.category,n=e.products;return(0,a.jsx)("section",{children:(0,a.jsxs)("div",{className:"max-w-screen-xl px-4 py-8 mx-auto",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"inline-block w-12 h-1 bg-red-400"}),(0,a.jsx)("h2",{className:"mt-1 text-2xl font-extrabold tracking-wide uppercase lg:text-3xl",children:t})]}),!n.length&&(0,a.jsx)("p",{children:"This category does not have products for sale."}),(0,a.jsx)("div",{className:"grid grid-cols-1 mt-8 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-4 gap-y-8",children:n.map((function(e,t){return(0,a.jsx)(S,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){P(e,t,n[t])}))}return e}({},e),t)}))})]})})};function C(e,t,n,r,a,s,i){try{var o=e[s](i),c=o.value}catch(l){return void n(l)}o.done?t(c):Promise.resolve(c).then(r,a)}function T(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function i(e){C(s,r,a,i,o,"next",e)}function o(e){C(s,r,a,i,o,"throw",e)}i(void 0)}))}}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){_(e,t,n[t])}))}return e}var E=(0,n(1796).Ue)({url:"https://ipfs.infura.io:5001/api/v0"}),D=function(e){var t=e.onProductCreated,n=(0,s.useState)({name:"",price:"",image_url:"",type:"image",description:""}),r=n[0],i=n[1],c=(0,s.useState)({}),l=c[0],u=c[1],d=(0,s.useState)(!1),m=d[0],p=d[1];function f(){return(f=T(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(!0),n=t.target.files,e.prev=2,console.log(n[0]),e.next=6,E.add(n[0]);case 6:r=e.sent,u({filename:n[0].name,hash:r.path}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.log("Error uploading file: ",e.t0);case 13:p(!1);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}var x=function(){var e=T(o().mark((function e(){var n,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=I({},r,l),console.log("Sending product to api:",n),e.next=5,fetch("../api/addProduct",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 5:return a=e.sent,e.next=8,a.json();case 8:s=e.sent,200===a.status?(alert("Product added!"),t()):alert("Unable to add product: ".concat(s.error)),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();return(0,a.jsx)("div",{className:"max-w-screen-xl px-4 py-16 mx-auto sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto mt-8 mb-0 space-y-4",children:[(0,a.jsx)("header",{className:"max-w-lg mx-auto text-center",children:(0,a.jsx)("h1",{className:"text-2xl font-bold sm:text-3xl",children:"Create Product"})}),(0,a.jsxs)("div",{className:"max-w-md mx-auto mt-8 mb-0 space-y-4 text-gray-700",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"fileName",className:"sr-only",children:"Product File"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"file",id:"fileName",name:"fileName",className:"block w-full text-sm text-lime-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-lime-50 file:text-lime-700 hover:file:bg-lime-100",accept:".png,.jpg,.jpeg,.mp4,.gif",placeholder:"Select File",onChange:function(e){return f.apply(this,arguments)}}),null!=l.name&&(0,a.jsx)("p",{className:"file-name",children:l.filename})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"productName",className:"sr-only",children:"Product Name"}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("input",{type:"text",id:"productName",name:"productName",className:"w-full p-4 pr-12 text-sm border-gray-200 rounded-lg shadow-sm",placeholder:"Enter product name",onChange:function(e){i(I({},r,{name:e.target.value.trim()}))}})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"price",className:"sr-only",children:"Price (USDC)"}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("input",{type:"number",min:1e-7,id:"price",name:"price",className:"w-full p-4 pr-12 text-sm border-gray-200 rounded-lg shadow-sm",placeholder:"Enter Price",onChange:function(e){i(I({},r,{price:e.target.value.trim()}))}})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"url",className:"sr-only",children:"Product URL"}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("input",{type:"text",id:"url",name:"url",className:"w-full p-4 pr-12 text-sm border-gray-200 rounded-lg shadow-sm",placeholder:"Image URL ex: https://i.imgur.com/yip6Ilu.jpg",onChange:function(e){i(I({},r,{image_url:e.target.value.trim()}))}})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"assetType",className:"sr-only",children:"Asset Type"}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)("select",{id:"assetType",name:"assetType",className:"w-full p-4 pr-12 text-sm border-gray-200 rounded-lg shadow-sm",placeholder:"Image URL ex: https://i.imgur.com/yip6Ilu.jpg",onChange:function(e){i(I({},r,{type:e.target.value}))},children:[(0,a.jsx)("option",{value:"image",defaultValue:"image",children:"Image"}),(0,a.jsx)("option",{value:"video",children:"Video"})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"description",className:"sr-only",children:"Description"}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("input",{type:"text",id:"description",name:"description",className:"w-full p-4 pr-12 text-sm border-gray-200 rounded-lg shadow-sm",placeholder:"Product description",onChange:function(e){i(I({},r,{description:e.target.value.trim()}))}})})]})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{className:"block m-auto px-3 py-3 text-sm font-medium text-white transition bg-lime-600 rounded-lg hover:bg-lime-700 focus:outline-none focus:ring",onClick:function(){x()},disabled:m||!r.name||!r.description||!r.image_url||!r.price,children:"Create Product"})})]})})},F=n(9008),U=n.n(F);function B(){return(0,a.jsxs)(U(),{children:[(0,a.jsx)("meta",{name:"viewport",content:"initial-scale=1.0, width=device-width"}),(0,a.jsx)("meta",{name:"theme-color",content:"#000000"}),(0,a.jsx)("title",{children:"StreamPay Store"}),(0,a.jsx)("meta",{name:"title",content:"StreamPay Store"}),(0,a.jsx)("meta",{name:"description",content:"Buy Tokenized gold using SolanaPay!"}),(0,a.jsx)("meta",{property:"twitter:card",content:"summary_large_image"}),(0,a.jsx)("meta",{property:"twitter:url",content:"https://twitter.com/stream_protocol"}),(0,a.jsx)("meta",{property:"twitter:title",content:"StreamPay Store"}),(0,a.jsx)("meta",{property:"twitter:description",content:"Buy Tokenized gold using SolanaPay!"}),(0,a.jsx)("meta",{property:"twitter:image",content:"https://i.imgur.com/vGRVFMJ.png"})]})}var L=n(8348),R=function(){var e=(0,x.Os)(),t=e.publicKey,n=e.disconnect;return(0,a.jsx)("header",{children:(0,a.jsx)("div",{className:"max-w-screen-xl px-4 py-8 mx-auto sm:py-12 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"sm:justify-between sm:items-center sm:flex",children:[(0,a.jsxs)("div",{className:"text-center sm:text-left",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold sm:text-3xl",children:"StreamPay Store"}),(0,a.jsx)("p",{className:"mt-1.5 text-sm text-gray-500",children:"Tokenizing Physical Gold"})]}),(0,a.jsx)("div",{className:"flex flex-col gap-4 mt-4 sm:flex-row sm:mt-0 sm:items-center",children:t?(0,a.jsx)("button",{className:"block px-5 py-3 text-sm font-medium text-white transition bg-indigo-600 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring",onClick:n,children:"Logout"}):(0,a.jsx)(L.aD,{className:"block px-5 py-3 text-sm font-medium text-white transition bg-indigo-600 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring"})})]})})})},J=n(4155),K=function(){var e=(0,x.Os)(),t=e.publicKey,n=e.connected,r=!!t&&t.toString()===J.env.NEXT_PUBLIC_OWNER_PUBLIC_KEY,i=(0,s.useState)(!1),o=i[0],c=i[1],l=(0,s.useState)([]),u=l[0],d=l[1],m=function(){fetch("/api/fetchProducts").then((function(e){return e.json()})).then((function(e){return d(e)})).catch((function(e){return console.error("Failed to fetch products:",e)}))};return(0,s.useEffect)((function(){n&&t&&m(),n||d([])}),[t,n]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(B,{}),(0,a.jsxs)("div",{className:"bg-gray-900 text-slate-200",children:[(0,a.jsx)(R,{}),(0,a.jsxs)("div",{className:"container m-auto",children:[r&&(0,a.jsx)("button",{className:"block m-auto px-3 py-3 text-sm font-medium text-white transition bg-lime-600 rounded-lg hover:bg-lime-700 focus:outline-none focus:ring",onClick:function(){return c(!o)},children:o?"Close":"Create Product"}),o&&(0,a.jsx)(D,{onProductCreated:m}),!n&&(0,a.jsx)("p",{className:"text-center",children:"Connect with you wallet to see all available products"}),!!n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(O,{category:"Emojis",products:u}),(0,a.jsx)(O,{category:"Goods",products:[]})]})]})]})]})}},3897:function(){},8795:function(){}},function(e){e.O(0,[431,985,774,888,179],(function(){return t=8312,e(e.s=t);var t}));var t=e.O();_N_E=t}]);